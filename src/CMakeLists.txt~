LINK_DIRECTORIES( ${OPENSYNC_LIBRARY_DIRS} ${GLIB2_LIBRARY_DIRS} ${LIBXML2_LIBRARY_DIRS} ${RUBY_LIBRARY})
INCLUDE_DIRECTORIES( ${OPENSYNC_INCLUDE_DIRS} ${GLIB2_INCLUDE_DIRS} ${LIBXML2_INCLUDE_DIRS} ${RUBY_INCLUDE_DIRS})

INCLUDE( ${SWIG_USE_FILE} )
SET(CMAKE_SWIG_FLAGS -Werror -Wall)

# TODO: How to make swig not build opensunc.so.so???
SWIG_ADD_MODULE( opensync.so ruby opensync.i )
SWIG_LINK_LIBRARIES( opensync.so opensync ${RUBY_LIBRARY} ${GLIB2_LIBRARIES} ${LIBXML2_LIBRARIES} )
  
# Include SWIG in include in order to compile it with ruby_module
INCLUDE_DIRECTORIES( ${swig_outdir} )

OPENSYNC_PLUGIN_ADD( ruby-module ruby_module.c )
#OPENSYNC_FORMAT_ADD( ruby-format ruby_module.c )
#OPENSYNC_FORMAT_ADD( plain plain.c )

TARGET_LINK_LIBRARIES( ruby-module ${OPENSYNC_LIBRARIES} ${GLIB2_LIBRARIES} ${LIBXML2_LIBRARIES} ${RUBY_LIBRARY})
#TARGET_LINK_LIBRARIES( ruby-format ${OPENSYNC_LIBRARIES} ${GLIB2_LIBRARIES} ${LIBXML2_LIBRARIES} ${RUBY_LIBRARY})

###### INSTALL ################### 
OPENSYNC_PLUGIN_INSTALL( ruby-module ) 

OPENSYNC_PLUGIN_CONFIG( ruby-module )

#LINK_DIRECTORIES( ${GLIB2_LIBRARY_DIRS} ${LIBXML2_LIBRARY_DIRS} ${SQLITE3_LIBRARY_DIRS} )


#	INSTALL( FILES ${CMAKE_CURRENT_BINARY_DIR}/_opensync${CMAKE_SHARED_MODULE_SUFFIX}
#	   DESTINATION ${LIB_INSTALL_DIR}/python${PYTHON_VERSION}/site-packages/ )
#	INSTALL( FILES ${CMAKE_CURRENT_BINARY_DIR}/opensync_hack.py
#	   DESTINATION ${LIB_INSTALL_DIR}/python${PYTHON_VERSION}/site-packages/ RENAME opensync.py )

